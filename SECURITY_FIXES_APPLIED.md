# üîí –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

–î–∞—Ç–∞: 2025-11-09
–ü—Ä–æ–µ–∫—Ç: 360¬∞ –†–ê–ë–û–¢–ê

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### üî¥ 1. –î–û–ë–ê–í–õ–ï–ù RATE LIMITING

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS –∞—Ç–∞–∫ –∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞. –í–æ–∑–º–æ–∂–Ω—ã –æ–≥—Ä–æ–º–Ω—ã–µ —Å—á–µ—Ç–∞ –∑–∞ SMS.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `/backend/src/middleware/rateLimiter.ts` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –∑–∞—â–∏—Ç—ã
- ‚úÖ –û–±—â–∏–π –ª–∏–º–∏—Ç: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç
- ‚úÖ **SMS –ª–∏–º–∏—Ç: 1 SMS –≤ –º–∏–Ω—É—Ç—É** (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å—á–µ—Ç–æ–≤!)
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: 10 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 15 –º–∏–Ω—É—Ç
- ‚úÖ –ü–ª–∞—Ç–µ–∂–∏: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ —á–∞—Å

**–§–∞–π–ª—ã:**
- `backend/src/middleware/rateLimiter.ts` - –°–û–ó–î–ê–ù
- `backend/src/server.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `backend/src/routes/auth.routes.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã

---

### üî¥ 2. –ò–°–ü–†–ê–í–õ–ï–ù–´ JWT –°–ï–ö–†–ï–¢–´

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∞–±—ã–µ fallback —Å–µ–∫—Ä–µ—Ç—ã `'your-secret-key'` - –ª–µ–≥–∫–æ —É–≥–∞–¥—ã–≤–∞–µ–º—ã–µ!

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£–±—Ä–∞–Ω—ã fallback –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –ó–ê–ü–£–°–¢–ò–¢–°–Ø –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ `.env.example`

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

**–§–∞–π–ª—ã:**
- `backend/src/utils/jwt.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `backend/.env.example` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

### üî¥ 3. –ò–°–ü–†–ê–í–õ–ï–ù CORS

**–ü—Ä–æ–±–ª–µ–º–∞:** Fallback –Ω–∞ `'*'` —Ä–∞–∑—Ä–µ—à–∞–ª –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±—ã—Ö –¥–æ–º–µ–Ω–æ–≤!

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –í development: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ `localhost:3000` –∏ `localhost:8081`
- ‚úÖ –í production: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `CORS_ORIGIN`
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ production –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ CORS

**–§–∞–π–ª—ã:**
- `backend/src/server.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω

---

### üî¥ 4. –£–ú–ï–ù–¨–®–ï–ù JSON BODY LIMIT

**–ü—Ä–æ–±–ª–µ–º–∞:** 50MB –ª–∏–º–∏—Ç –ø–æ–∑–≤–æ–ª—è–ª DoS –∞—Ç–∞–∫—É —á–µ—Ä–µ–∑ –æ–≥—Ä–æ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ –¥–æ 1MB –¥–ª—è –æ–±—ã—á–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ–ª–∂–Ω–∞ –∏–¥—Ç–∏ —á–µ—Ä–µ–∑ multer —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏

**–§–∞–π–ª—ã:**
- `backend/src/server.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω

---

### üî¥ 5. –î–û–ë–ê–í–õ–ï–ù–ê –í–ê–õ–ò–î–ê–¶–ò–Ø WEBHOOK –û–¢ ALFABANK

**–ü—Ä–æ–±–ª–µ–º–∞:** Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –ë–ï–ó –ü–†–û–í–ï–†–ö–ò –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏!
**–†–∏—Å–∫:** –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–≥ –ø–æ–¥–¥–µ–ª–∞—Ç—å webhook –∏ –∑–∞—á–∏—Å–ª–∏—Ç—å —Å–µ–±–µ –¥–µ–Ω—å–≥–∏!

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `validateWebhook()` –≤ `AlfabankPaymentService`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ MD5 checksum –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö webhook
- ‚úÖ Webhook –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ checksum –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è —Å 401

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ALFABANK_CHECKSUM_SECRET` –≤ `.env`
- –ü–æ–ª—É—á–∏—Ç—å —Å–µ–∫—Ä–µ—Ç –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ê–ª—å—Ñ–∞–±–∞–Ω–∫ —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞

**–§–∞–π–ª—ã:**
- `backend/src/services/AlfabankPaymentService.ts` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `backend/src/controllers/BillingController.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
- `backend/.env.example` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è

---

### üü¢ 6. –°–û–ó–î–ê–ù MODERATOR MIDDLEWARE

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `/backend/src/middleware/requireModerator.ts`
- ‚úÖ –î–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: `requireModerator` –∏ `requireAdmin`
- ‚úÖ –ì–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ moderation routes

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import { requireModerator } from '../middleware/requireModerator';

router.get('/videos', authMiddleware, requireModerator, ModerationController.getPendingVideos);
```

**–§–∞–π–ª—ã:**
- `backend/src/middleware/requireModerator.ts` - –°–û–ó–î–ê–ù

---

### üü¢ 7. –ù–ê–°–¢–†–û–ï–ù–û WINSTON –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `/backend/src/utils/logger.ts`
- ‚úÖ –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: debug, info, warn, error
- ‚úÖ –í production: –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª—ã `combined.log`, `error.log`, `critical.log`
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤: –º–∞–∫—Å–∏–º—É–º 10MB –Ω–∞ —Ñ–∞–π–ª, 5-10 —Ñ–∞–π–ª–æ–≤

**–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `logPayment()` - –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- `logSecurity()` - –¥–ª—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `logError()` - –¥–ª—è –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- `logSuccess()` - –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import logger, { logPayment, logSecurity } from '../utils/logger';

logPayment('Payment completed', { amount: 1000, userId: '123' });
logSecurity('Failed login attempt', { ip: '192.168.1.1', phone: '+79991234567' });
```

**–§–∞–π–ª—ã:**
- `backend/src/utils/logger.ts` - –°–û–ó–î–ê–ù

---

## üìã –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø –ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã
```bash
cd backend
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å:

```bash
cp .env.example .env
```

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

1. **JWT —Å–µ–∫—Ä–µ—Ç—ã** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–∞:
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# –í—Å—Ç–∞–≤–∏—Ç—å –≤ .env:
JWT_SECRET=<–ø–µ—Ä–≤—ã–π_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç>
JWT_REFRESH_SECRET=<–≤—Ç–æ—Ä–æ–π_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç>
```

2. **CORS** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è production):
```env
# Development
CORS_ORIGIN=http://localhost:3000,http://localhost:8081

# Production
CORS_ORIGIN=https://yourdomain.com,https://app.yourdomain.com
```

3. **Alfabank Checksum Secret** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Alfabank):
```env
ALFABANK_CHECKSUM_SECRET=<—Å–µ–∫—Ä–µ—Ç_–∏–∑_–ª–∏—á–Ω–æ–≥–æ_–∫–∞–±–∏–Ω–µ—Ç–∞_alfabank>
```

### 3. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
```bash
mkdir -p backend/logs
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
```bash
cd backend
npm run dev
```

---

## üéØ –§–ò–ù–ê–ù–°–û–í–ê–Ø –û–¶–ï–ù–ö–ê –†–ò–°–ö–û–í (–î–û/–ü–û–°–õ–ï)

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–∏—Å–∫ –î–û | –†–∏—Å–∫ –ü–û–°–õ–ï |
|----------|---------|------------|
| –ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS | **100,000‚ÇΩ+/–¥–µ–Ω—å** | ‚úÖ –ú–∞–∫—Å–∏–º—É–º 60‚ÇΩ/—á–∞—Å |
| –ü–æ–¥–¥–µ–ª–∫–∞ Alfabank webhook | **–ù–ï–û–ì–†–ê–ù–ò–ß–ï–ù–ù–´–ô** | ‚úÖ –ò–°–ö–õ–Æ–ß–Å–ù |
| JWT –±—Ä—É—Ç—Ñ–æ—Ä—Å | –í—ã—Å–æ–∫–∏–π | ‚úÖ –ò—Å–∫–ª—é—á—ë–Ω |
| DoS —á–µ—Ä–µ–∑ –±–æ–ª—å—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã | –°—Ä–µ–¥–Ω–∏–π | ‚úÖ –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω |

---

## üìä –û–°–¢–ê–í–®–ò–ï–°–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–ù–ï –ö–†–ò–¢–ò–ß–ù–û)

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **Helmet CSP –ø–æ–ª–∏—Ç–∏–∫–∏** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
2. **Redis –¥–ª—è rate limiting** - –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
3. **Sentry** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ production
4. **Connection pooling** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î
5. **Cursor-based pagination** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:

6. SSL Pinning –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
7. –û–±—Ñ—É—Å–∫–∞—Ü–∏—è frontend –∫–æ–¥–∞
8. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ AsyncStorage

---

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ó–ê–ü–£–°–ö–£

### ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ø—Ä–æ–±–ª–µ–º—ã - –ò–°–ü–†–ê–í–õ–ï–ù–´

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å **–ë–ï–ó–û–ü–ê–°–ï–ù** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º —Ä—ã–Ω–∫–µ!

### –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ production:

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞–¥—ë–∂–Ω—ã–µ JWT —Å–µ–∫—Ä–µ—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω CORS –¥–ª—è production –¥–æ–º–µ–Ω–æ–≤
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ALFABANK_CHECKSUM_SECRET (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
- [ ] –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `logs/`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (HTTPS)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry/Grafana)

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `backend/logs/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç)

---

**–ê–≤—Ç–æ—Ä:** Claude Code
**–î–∞—Ç–∞:** 2025-11-09
**–í–µ—Ä—Å–∏—è:** 1.0.0
